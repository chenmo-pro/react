## 3.组件的状态管理

[State & 生命周期](https://zh-hans.reactjs.org/docs/state-and-lifecycle.html)

[Props 的只读性](https://zh-hans.reactjs.org/docs/components-and-props.html#props-are-read-only)

其中有关函数组件的知识点，暂时跳过

### 3.1 Props的只读性

#### 3.1.1纯函数

1.不会更改入参（输入）

2.多次输入有相同输出

3.例子

```js
function Sum(a,b){
    return a+b;
}
```

#### 3.1.2 Props的只读性

子组件的Props(property)继承于父组件 包括属性和方法

react组件的props不能更改

### 3.2 React.Component api

#### 3.2.1 结构

react组件的使用在于组合而不是继承（理解）继承component

必有render()方法!

```js
class Person extends React.component{
    render(){
        return <h1>hello</h1>;
    }
}
```

#### 3.2.2  挂载

##### 1.constructor(props)初始化state,继承父类的属性和方法

作用：初始化state 

```js
this.state = {color:white};
```

只能在constructor设置this.state,其他方法如componentDidMount中使用setState()

继承父类的属性和方法 

```js
super(props)
```

为什么不能在state中使用this.props

首先没有必要，如果要使用属性可以直接this.props.xxx

其次会有bug，属性变化时不会影响state（为什么）

```js
constructor(props) {
 super(props);
 // 不要这样做
 this.state = { color: props.color };
}
```

##### 2.准备更新的一个方法 [`static getDerivedStateFromProps(props,state)`] (了解)

返回一个对象并更新state

字面理解 静态 从属性中获取到状态？

##### 3.render()渲染

1.必须执行

2.纯函数，不与浏览器交互（为什么）

3.返回

```js
{
1.react元素 自定义组件<myComponent /> 页面元素<div></div>
2.简单数据类型  
字符串 数 文本节点
布尔值  不渲染
3.数组及碎片fragments
4.portals 门户网站
}

```

##### 4.componentDidMount()组件已经挂载

初始化dom节点

实例化请求

setState()

#### 3.2.3 更新

`static getDerivedStateFromProps(props,state)`更新state

shouldComponentUpdate(nextProps, nextState)   默认为true state变化重新渲染 

返回false不会执行render()

##### render() 渲染

getSnapshotBeforeUpdate()

##### componentDidUpdate(prevProps,prevState,snapshot) 组件已经更新

#### 3.2.4 卸载

componentWillUnmount()

组件卸载或销毁前调用，执行清理操作

**实例调用`setState()`**，因为该组件将永远不会重新渲染。组件实例卸载后，将永远不会再挂载它。

没看懂 在这里实例调用setState()有什么用

```js
setState(updater, [callback])
输入更新的状态，输出
```

### 3.3 要求

1.组件状态管理有哪几种方式？

react-redux

react-hooks

dva

2.如何触发组件进行渲染

组件首次挂载，初始化以后会进行渲染

当props和state更新时会触发rander()

3.state值如何改变，props值如何改变

props的只读性，继承于父组件的属性，react组件的props不能更改

state可以更改，在constructor()初始化，在componentDidMount或其他方法使用setState()更改

不可以使用props初始化state

4.使用state有哪些注意点

不要直接改变this.state，后续setState会进行替换

state在constructor()初始化

setState()的两种使用方式

向setState传入一个函数使用  

```js
{
    setstate(
    (prevState)=>({count:prevState.count+1})
    )
}
```

向setState传入一个对象使用

```js
{
    this.setstate({
        name:hailong,
        age:23
    })
}
```

5.state是同步还是异步，还是....

异步

setState()以后无法立刻改变组件中state的值

拓展题目，自己去查：什么是状态提升，和js中的变量提升进行辩证分析同异处

状态提升

子组件不改变自己的状态，通过设置子组件的props的值，把操作的数据传递给父组件，改变父组件的状态，从而改变其所有子组件的状态

```js
handleChange(event) {
                this.props.dollarChange(event.target.value); //将子组件的值通过props传给父组件
            }
```

变量提升：可以先调用再进行声明和赋值

将声明提升到当前作用域的顶端

```js
{
    console.log(a);
    var a =100
}
实际是
{
    var a;
    console.log(a);
    a = 100;
}
```

同：都有提升的操作

异：一个是提升到作用域的顶端，一个是提升到父组件的状态

![微信图片_20210116150258](https://gitee.com/chenmo97/react/raw/master/img/20210116150411.png)